import { readFileSync, writeFileSync } from "fs";
import { fileURLToPath } from "url";
import { dirname, join } from "path";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const mcpAppsHtmlPath = join(
  __dirname,
  "../server/routes/apps/mcp-apps/sandbox-proxy.html",
);
const chatgptAppsHtmlPath = join(
  __dirname,
  "../server/routes/apps/chatgpt-apps/sandbox-proxy.html",
);
const outputTsPath = join(
  __dirname,
  "../server/routes/apps/SandboxProxyHtml.bundled.ts",
);

try {
  const mcpAppsHtml = readFileSync(mcpAppsHtmlPath, "utf-8");
  const chatgptAppsHtml = readFileSync(chatgptAppsHtmlPath, "utf-8");

  const outputContent = `// This file is auto-generated by scripts/bundle-sandbox-proxy-html.js
// Do not edit directly - modify sandbox-proxy.html files instead

export const MCP_APPS_SANDBOX_PROXY_HTML = ${JSON.stringify(mcpAppsHtml)};
export const CHATGPT_APPS_SANDBOX_PROXY_HTML = ${JSON.stringify(chatgptAppsHtml)};
`;

  writeFileSync(outputTsPath, outputContent);
  process.stdout.write("Successfully bundled sandbox proxy HTML files\n");
} catch (error) {
  process.stderr.write(
    `Failed to bundle sandbox proxy HTML files: ${error instanceof Error ? error.message : String(error)}\n`,
  );
  process.exit(1);
}
